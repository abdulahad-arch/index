<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Smart AgriAdvisor — Soil & Crop Advisor</title>
<style>
  body{font-family:Arial,Helvetica,sans-serif;margin:0;padding:0;background:#f7f7f7;color:#222}
  header{background:#2b6cb0;color:#fff;padding:16px;text-align:center;font-size:20px;font-weight:700}
  .container{padding:14px;max-width:980px;margin:12px auto}
  .card{background:#fff;padding:12px;border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,0.06);margin-bottom:12px}
  label{display:block;font-weight:700;margin-bottom:6px}
  .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  input,select,button,textarea{padding:8px;border-radius:6px;border:1px solid #ddd;font-size:14px}
  button{background:#2b6cb0;color:#fff;border:none;cursor:pointer}
  button.gray{background:#718096}
  button.small{padding:6px 8px;font-size:13px}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:10px}
  .result{color:#0b6b35;font-weight:700;margin-top:8px}
  pre{background:#0f1724;color:#e6eef8;padding:10px;border-radius:6px;overflow:auto;max-height:220px}
  .small{font-size:13px;color:#666}
  table{width:100%;border-collapse:collapse}
  th,td{padding:6px;border:1px solid #eee;text-align:left;font-size:13px}
  .nut-low{color:#c53030;font-weight:700}
  .nut-ok{color:#2f855a;font-weight:700}
  .nut-high{color:#ed8936;font-weight:700}
</style>
</head>
<body>
<header>🌱 Smart AgriAdvisor — Soil & Crop Advisor</header>
<div class="container">

  <!-- Soil & Environment -->
  <div class="card">
    <label>Soil & Environment (manual entry)</label>
    <div class="grid">
      <div><label>pH</label><input id="inpPH" type="number" step="0.1" min="0" max="14"/></div>
      <div><label>Moisture (%)</label><input id="inpMoist" type="number" step="1" min="0" max="100"/></div>
      <div><label>Temperature (°C)</label><input id="inpTemp" type="number" step="0.1"/></div>
      <div><label>Humidity (%)</label><input id="inpHum" type="number" step="1" min="0" max="100"/></div>
    </div>
    <div class="row" style="margin-top:10px">
      <button id="btnSaveManual" class="small">Save Values</button>
      <button id="btnPredictNutrients" class="small gray">Predict Soil Nutrients</button>
      <button id="btnRefreshSoil" class="small">Refresh</button>
    </div>
    <div id="nutrientResult" style="margin-top:10px"></div>
    <div id="soilNotes" class="small" style="margin-top:8px;color:#374151"></div>
  </div>

  <!-- Crop Selection -->
  <div class="card">
    <label>Crop Selection & AI</label>
    <div class="row">
      <select id="cropSelect" style="flex:1"></select>
      <button id="btnCheck" class="small">Check Suitability</button>
      <button id="btnAI" class="small gray">AI Suggest</button>
      <button id="btnRefreshCrops" class="small">Refresh</button>
    </div>
    <div id="lblResult" class="result"></div>
    <div id="aiList" class="small" style="margin-top:6px"></div>
  </div>

  <!-- Profit -->
  <div class="card">
    <label>Profit Estimator</label>
    <div class="row">
      <select id="cropProfit" style="flex:1"></select>
      <input id="yieldInput" placeholder="Yield (quintals)" style="width:160px"/>
      <button id="btnProfit" class="small">Estimate</button>
      <button id="btnRefreshProfit" class="small gray">Refresh</button>
    </div>
    <div id="lblProfit" class="result" style="margin-top:8px"></div>
  </div>

  <!-- Translator -->
  <div class="card">
    <label>Translator</label>
    <div class="row">
      <input id="txtTranslate" placeholder="Enter text" style="flex:1"/>
      <select id="langSelect">
        <option value="hi">Hindi</option>
        <option value="te">Telugu</option>
        <option value="ta">Tamil</option>
        <option value="mr">Marathi</option>
        <option value="bn">Bengali</option>
        <option value="gu">Gujarati</option>
        <option value="kn">Kannada</option>
        <option value="ur">Urdu</option>
        <option value="en">English</option>
        <option value="es">Spanish</option>
        <option value="fr">French</option>
        <option value="ar">Arabic</option>
      </select>
      <button id="btnTranslate" class="small">Translate</button>
      <button id="btnTranslateApp" class="small gray">Translate App</button>
    </div>
    <div id="lblTranslation" class="small" style="margin-top:8px"></div>
  </div>

  <!-- Weather -->
  <div class="card">
    <label>Weather Advisory</label>
    <div class="row">
      <input id="city" placeholder="City" style="flex:1"/>
      <button id="btnWeather" class="small">Check</button>
    </div>
    <div id="lblWeather" class="small" style="margin-top:8px"></div>
  </div>

  <!-- Debug -->
  <div class="card">
    <label>Debug</label>
    <pre id="debug">No data</pre>
  </div>
</div>

<script>
/* --- Crop DB (50 crops simplified) --- */
const cropDB=[
["Wheat",6,7.5,40,10,40,2000],["Rice",5.5,7,60,20,60,1800],["Maize",5.5,7,50,18,50,1500],
["Cotton",6,8,50,21,50,5000],["Potato",5.5,6.5,60,15,60,1200],["Tomato",5.5,7.5,50,18,60,1500],
["Onion",6,7,35,15,55,1400],["Sugarcane",6,8,60,21,60,3000],["Soybean",6,7.5,40,20,55,2500],
["Peanut",5.5,7,35,22,50,3000],["Sunflower",6,7.5,30,18,40,3200],["Barley",6,7.5,35,15,40,1600],
["Oats",5,7.5,35,12,40,1800],["Millet",5,7.5,30,20,35,1400],["Sorghum",5.5,7.5,35,22,35,1600],
["Chickpea",6,8,30,18,40,4000],["Lentil",6,8,30,16,40,4500],["Pea",6,7.5,35,15,60,2800],
["Mustard",5.5,7.5,30,18,50,5000],["Groundnut",5.5,7.5,35,22,55,3500],["Sesame",5.5,7.5,30,20,40,6000],
["Castor",5.5,7.5,30,20,40,4000],["Jute",6,7.5,50,20,70,2500],["Tea",4.5,6,60,18,80,12000],
["Coffee",5,6.5,60,20,70,15000],["Banana",5.5,7.5,50,22,70,1000],["Mango",5.5,7.5,30,25,60,3000],
["Apple",6,7,40,10,60,5000],["Orange",5.5,6.5,40,20,60,4000],["Grapes",6,7.5,35,20,60,4500],
["Papaya",6,7.5,40,22,65,2000],["Guava",5,7.5,35,20,60,2500],["Pineapple",4.5,6.5,50,22,70,3000],
["Pomegranate",5.5,7.5,35,20,50,5000],["Cabbage",6,7.5,40,15,80,1200],["Cauliflower",6,7.5,40,15,80,1400],
["Carrot",6,7,35,15,65,2000],["Spinach",6,7.5,35,15,70,1000],["Cucumber",5.5,7.5,40,18,70,1500],
["Chilli",5.5,7.5,40,20,60,6000],["Brinjal",5.5,7.5,40,20,60,2000],["Okra",6,7.5,40,20,60,2500],
["Pumpkin",6,7.5,40,18,60,1500],["Melon",5.5,7.5,35,20,60,2000],["Watermelon",5.5,7.5,35,22,60,1800],
["Strawberry",5.5,7,40,18,70,8000],["Pear",6,7,35,15,60,3500],["Plum",6,7.5,35,15,60,3000]
];

/* --- State --- */
let phVal=null, moistVal=null, tempVal=null, humVal=null;
let nutrients=null;

/* --- Init dropdowns --- */
function populateCrops(){
  const cropSelect=document.getElementById("cropSelect");
  const cropProfit=document.getElementById("cropProfit");
  cropSelect.innerHTML=""; cropProfit.innerHTML="";
  cropDB.forEach(c=>{
    cropSelect.add(new Option(c[0],c[0]));
    cropProfit.add(new Option(c[0],c[0]));
  });
}
window.onload=populateCrops;

/* --- Debug helper --- */
function setDebug(t){document.getElementById("debug").innerText=t;}

/* --- Nutrient prediction --- */
function predictNutrients(ph,moist,temp){
  const out={N:'OK',P:'OK',K:'OK',Ca:'OK',Fe:'OK',Zn:'OK'};
  if(moist<30||temp<12) out.N='Low';
  if(moist>85) out.N='Low';
  if(ph<5.5||ph>7.8) out.P='Low';
  if(moist>80) out.K='Low';
  if(ph<5.5) out.Ca='Low'; else if(ph>8) out.Ca='High';
  if(ph<6) out.Fe='High'; else if(ph>7.5) out.Fe='Low';
  if(ph<5.5) out.Zn='High'; else if(ph>7.5) out.Zn='Low';
  return out;
}
function renderNutrients(n){
  let html=`<table><tr><th>Nutrient</th><th>Status</th></tr>`;
  for(let k in n){html+=`<tr><td>${k}</td><td>${n[k]}</td></tr>`;}
  html+=`</table>`;
  document.getElementById("nutrientResult").innerHTML=html;
  document.getElementById("soilNotes").innerText="Heuristic only: real soil test needed for precision.";
}

/* --- Soil buttons --- */
document.getElementById("btnSaveManual").onclick=()=>{
  phVal=parseFloat(document.getElementById("inpPH").value);
  moistVal=parseFloat(document.getElementById("inpMoist").value);
  tempVal=parseFloat(document.getElementById("inpTemp").value);
  humVal=parseFloat(document.getElementById("inpHum").value);
  setDebug(`Saved pH:${phVal} Moist:${moistVal}% Temp:${tempVal}C Hum:${humVal}%`);
};
document.getElementById("btnPredictNutrients").onclick=()=>{
  if(phVal==null){alert("Save values first");return;}
  nutrients=predictNutrients(phVal,moistVal,tempVal);
  renderNutrients(nutrients);
};
document.getElementById("btnRefreshSoil").onclick=()=>{
  document.getElementById("inpPH").value="";
  document.getElementById("inpMoist").value="";
  document.getElementById("inpTemp").value="";
  document.getElementById("inpHum").value="";
  document.getElementById("nutrientResult").innerHTML="";
  document.getElementById("soilNotes").innerText="";
  setDebug("Soil values reset.");
  phVal=moistVal=tempVal=humVal=null; nutrients=null;
};

/* --- Crop buttons --- */
document.getElementById("btnCheck").onclick=()=>{
  if(phVal==null){alert("Save soil values first");return;}
  const cropName=document.getElementById("cropSelect").value;
  const crop=cropDB.find(c=>c[0]==cropName);
  let ok=(phVal>=crop[1]&&phVal<=crop[2]&&moistVal>=crop[3]&&tempVal>=crop[4]&&humVal>=crop[5]);
  document.getElementById("lblResult").innerText=ok?`✅ Suitable for ${cropName}`:`❌ Not Suitable`;
};
document.getElementById("btnAI").onclick=()=>{
  if(phVal==null){alert("Save soil values first");return;}
  const scored=cropDB.map(c=>{
    let s=0;
    if(phVal>=c[1]&&phVal<=c[2])s+=2;
    if(moistVal>=c[3])s++;
    if(tempVal>=c[4])s++;
    if(humVal>=c[5])s++;
    return {name:c[0],score:s};
  }).sort((a,b)=>b.score-a.score);
  document.getElementById("aiList").innerText="AI Suggests: "+scored.slice(0,5).map(x=>x.name).join(", ");
};
document.getElementById("btnRefreshCrops").onclick=()=>{
  populateCrops();
  document.getElementById("lblResult").innerText="";
  document.getElementById("aiList").innerText="";
  setDebug("Crops refreshed.");
};

/* --- Profit buttons --- */
document.getElementById("btnProfit").onclick=()=>{
  const cropName=document.getElementById("cropProfit").value;
  const y=parseFloat(document.getElementById("yieldInput").value||0);
  const crop=cropDB.find(c=>c[0]==cropName);
  document.getElementById("lblProfit").innerText=`Profit: ₹${(y*crop[6]).toLocaleString()}`;
};
document.getElementById("btnRefreshProfit").onclick=()=>{
  document.getElementById("yieldInput").value="";
  document.getElementById("lblProfit").innerText="";
  setDebug("Profit section refreshed.");
};

/* --- Translator --- */
async function translateText(text,lang){
  const url=`https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=en|${lang}`;
  try{const r=await fetch(url);const j=await r.json();return j.responseData.translatedText||text;}
  catch{ return text; }
}
document.getElementById("btnTranslate").onclick=async()=>{
  const txt=document.getElementById("txtTranslate").value.trim();
  if(!txt){alert("Enter text");return;}
  const lang=document.getElementById("langSelect").value;
  document.getElementById("lblTranslation").innerText="Translating...";
  const tr=await translateText(txt,lang);
  document.getElementById("lblTranslation").innerText=tr;
};
document.getElementById("btnTranslateApp").onclick=async()=>{
  const lang=document.getElementById("langSelect").value;
  const labels=document.querySelectorAll("label,button,header");
  for(const el of labels){
    const t=el.innerText;
    const tr=await translateText(t,lang);
    el.innerText=tr;
  }
  alert("App UI translated (may be imperfect).");
};

/* --- Weather --- */
document.getElementById("btnWeather").onclick=async()=>{
  const city=document.getElementById("city").value.trim();
  if(!city){alert("Enter city");return;}
  try{
    const res=await fetch(`https://wttr.in/${encodeURIComponent(city)}?format=%t+%h+%w`);
    const txt=await res.text();
    document.getElementById("lblWeather").innerText="Weather: "+txt;
  }catch(e){
    document.getElementById("lblWeather").innerText="⚠️ Weather fetch failed.";
  }
};
</script>
</body>
</html>
